{% extends 'cf-admin/base.html' %}
{% load event_tags %}
{% load admin_menu %}
{% load date_formatting %}
{% load cropping %}
{% load featured_event %}
{% load endless %}
{% load cf_pagination %}

{% block head %}
    <link href="{{STATIC_URL}}styles/profile-table.css" rel="stylesheet" type="text/css" />
    <script src="{{STATIC_URL}}js/actions/posting-to-facebook.js" type="text/javascript"></script>
{% endblock %}

{% block page %}
    <div class="tabs-container">
        {% cf_admin_menu "posting_to_facebook" %}

        <div class="box visible" data-id="posting_box" data-posting-url="{% url "post_event_to_facebook" %}">
            {% csrf_token %}
            <img class="mini-indicator" data-id="mini_indicator" src="{{ STATIC_URL }}images/mini-ajax-loader.gif" />
            <table class="profile-table" celpadding="0" cellspacing="0">
                <tr>
                    <th>Event</th>
                    <th>Owned by</th>
                    <th>From-To</th>
                    <th>Is posted</th>
                    <th>Action / Link to FB event</th>
                </tr>
                {% paginate 10 events %}
                {% for event in events %}
                    <tr data-type="posting_tr">
                        <td>{{ event.name }}</td>
                        <td>
                            {% if event.owner %}
                                <a href="{% url "admin:accounts_account_change" event.owner.id %}" target="_blank">{{ event.owner.username }}</a>
                            {% endif %}
                        </td>
                        <td>
                            {{ event.start_time|date:"b d, Y"|title }} - {{ event.end_time|date:"b d, Y"|title }}
                        </td>
                        <td data-type="posting_status">
                            {% if event.is_fb_posted %}
                                Yes
                            {% else %}
                                No
                            {% endif %}
                        </td>
                        <td>
                            {% if not event.is_fb_posted %}
                                <a href="javascript:void(0);" data-event-id="{{ event.id }}" data-type="posting_link">Post to Facebook</a>
                            {% else %}
                                <a href="https://www.facebook.com/events/{{ event.facebook_event.eid }}/">FB event link</a>
                            {% endif %}
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="4">
                            No events for posting was found
                        </td>
                    </tr>
                {% endfor %}
            </table>
            {% cf_pagination %}
        </div>
    </div>
{% endblock %}